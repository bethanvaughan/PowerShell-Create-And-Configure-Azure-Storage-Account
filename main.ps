# Interactive PowerShell script to create a storage account in Azure

# Function to prompt for a value with a default option
function PromptForInput {
    param (
        [string]$Message,
        [string]$Default = ""
    )
    $inputValue = Read-Host "$Message (Default: $Default)"
    if ([string]::IsNullOrWhiteSpace($inputValue)) {
        return $Default
    }
    return $inputValue
}

# Prompt for resource group
$resourceGroupName = PromptForInput -Message "Enter the name of the Resource Group" -Default "MyResourceGroup"
if ($resourceGroupName -eq $null) {
    Write-Host "Resource Group name is required." -ForegroundColor Red
    exit
}

# Prompt for location
$location = PromptForInput -Message "Enter the Azure region (e.g., uksouth)" -Default "uksouth"
if ($location -eq $null) {
    Write-Host "Location is required." -ForegroundColor Red
    exit
}

# Check if the resource group exists
Write-Host "Checking if Resource Group '$resourceGroupName' exists..."
$resourceGroup = Get-AzResourceGroup -Name $resourceGroupName -ErrorAction SilentlyContinue
if ($resourceGroup -eq $null) {
    $createGroup = Read-Host "Resource Group '$resourceGroupName' does not exist. Create it? (y/n)"
    if ($createGroup -eq 'y') {
        New-AzResourceGroup -Name $resourceGroupName -Location $location
        Write-Host "Resource Group '$resourceGroupName' created successfully."
    } else {
        Write-Host "Resource Group is required. Exiting script." -ForegroundColor Red
        exit
    }
}

# Prompt for storage account name
$storageAccountName = PromptForInput -Message "Enter the Storage Account name (3-24 chars, lowercase letters/numbers only)"
if ($storageAccountName -eq $null -or $storageAccountName.Length -lt 3 -or $storageAccountName.Length -gt 24) {
    Write-Host "Invalid Storage Account name. Ensure it is between 3 and 24 characters." -ForegroundColor Red
    exit
}

# Prompt for SKU type
$sku = PromptForInput -Message "Enter the SKU type (Standard_LRS, Standard_GRS, etc.)" -Default "Standard_LRS"
if ($sku -eq $null) {
    Write-Host "SKU type is required." -ForegroundColor Red
    exit
}

# Prompt for storage account kind
$storageKind = PromptForInput -Message "Enter the Storage Account kind (StorageV2, BlobStorage, etc.)" -Default "StorageV2"
if ($storageKind -eq $null) {
    Write-Host "Storage Account kind is required." -ForegroundColor Red
    exit
}

# Check if the storage account already exists
Write-Host "Checking if Storage Account '$storageAccountName' exists..."
$storageAccount = Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName -ErrorAction SilentlyContinue
if ($storageAccount -ne $null) {
    Write-Host "Storage Account '$storageAccountName' already exists." -ForegroundColor Yellow
    exit
}

# Create the storage account
Write-Host "Creating Storage Account '$storageAccountName' in Resource Group '$resourceGroupName'..."
New-AzStorageAccount `
    -ResourceGroupName $resourceGroupName `
    -Name $storageAccountName `
    -Location $location `
    -SkuName $sku `
    -Kind $storageKind

Write-Host "Storage Account '$storageAccountName' created successfully." -ForegroundColor Green

